import{GLTFLoader as e}from"./glTFLoader-ASl42hNE.esm.min.js";import{aW as a,bK as o,bJ as r}from"./index-BeBPThKX.esm.min.js";import"./bone-4zSTwM2L.esm.min.js";import"./skeleton-BM6jc2S2.esm.min.js";import"./rawTexture-OHFtV4yv.esm.min.js";import"./assetContainer-C4iCgc7c.esm.min.js";import"./objectModelMapping-C_2yKgOV.esm.min.js";const t="KHR_materials_clearcoat";class n{constructor(e){this.name=t,this.order=190,this._loader=e,this.enabled=this._loader.isExtensionUsed(t)}dispose(){this._loader=null}loadMaterialPropertiesAsync(a,o,r){return e.LoadExtensionAsync(a,o,this.name,(async(e,t)=>{const n=new Array;n.push(this._loader.loadMaterialPropertiesAsync(a,o,r)),n.push(this._loadClearCoatPropertiesAsync(e,t,r));const s=this._loader._getOrCreateMaterialAdapter(r);if(t.extensions&&t.extensions.KHR_materials_clearcoat_darkening){const a=t.extensions.KHR_materials_clearcoat_darkening;n.push(this._loadClearCoatDarkeningPropertiesAsync(e,a,r))}if(t.extensions&&t.extensions.KHR_materials_clearcoat_ior){const e=t.extensions.KHR_materials_clearcoat_ior;let a=1.5;void 0!==e.clearcoatIor&&(a=e.clearcoatIor),s.coatIor=a}if(t.extensions&&t.extensions.KHR_materials_clearcoat_anisotropy){const a=t.extensions.KHR_materials_clearcoat_anisotropy;n.push(this._loadClearCoatAnisotropyPropertiesAsync(e,a,r))}if(t.extensions&&t.extensions.KHR_materials_clearcoat_color){const a=t.extensions.KHR_materials_clearcoat_color;n.push(this._loadClearCoatColorPropertiesAsync(e,a,r))}await Promise.all(n)}))}_loadClearCoatPropertiesAsync(e,a,o){const r=this._loader._getOrCreateMaterialAdapter(o),t=new Array;return r.configureCoat(),r.coatWeight=void 0!==a.clearcoatFactor?a.clearcoatFactor:0,r.coatRoughness=void 0!==a.clearcoatRoughnessFactor?a.clearcoatRoughnessFactor:0,a.clearcoatTexture&&t.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatTexture`,a.clearcoatTexture,(e=>{e.name=`${o.name} (ClearCoat)`,r.coatWeightTexture=e}))),a.clearcoatRoughnessTexture&&(a.clearcoatRoughnessTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatRoughnessTexture`,a.clearcoatRoughnessTexture,(e=>{e.name=`${o.name} (ClearCoat Roughness)`,r.coatRoughnessTexture=e})))),a.clearcoatNormalTexture&&(a.clearcoatNormalTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatNormalTexture`,a.clearcoatNormalTexture,(e=>{e.name=`${o.name} (ClearCoat Normal)`,r.geometryCoatNormalTexture=e,null!=a.clearcoatNormalTexture?.scale&&(r.geometryCoatNormalTextureScale=a.clearcoatNormalTexture.scale)}))),r.setNormalMapInversions(!o.getScene().useRightHandedSystem,o.getScene().useRightHandedSystem)),Promise.all(t).then((()=>{}))}_loadClearCoatDarkeningPropertiesAsync(e,a,o){const r=this._loader._getOrCreateMaterialAdapter(o),t=new Array;return r.coatDarkening=void 0!==a.clearcoatDarkeningFactor?a.clearcoatDarkeningFactor:1,a.clearcoatDarkeningTexture&&(a.clearcoatDarkeningTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatDarkeningTexture`,a.clearcoatDarkeningTexture,(e=>{e.name=`${o.name} (ClearCoat Darkening)`,r.coatDarkeningTexture=e})))),Promise.all(t).then((()=>{}))}_loadClearCoatColorPropertiesAsync(e,o,r){const t=this._loader._getOrCreateMaterialAdapter(r),n=new Array,s=a.White();return void 0!==o.clearcoatColorFactor&&s.fromArray(o.clearcoatColorFactor),t.coatColor=s,o.clearcoatColorTexture&&n.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatColorTexture`,o.clearcoatColorTexture,(e=>{e.name=`${r.name} (ClearCoat Color)`,t.coatColorTexture=e}))),Promise.all(n).then((()=>{}))}_loadClearCoatAnisotropyPropertiesAsync(e,a,o){const r=this._loader._getOrCreateMaterialAdapter(o),t=new Array,n=a.clearcoatAnisotropyStrength??0,s=a.clearcoatAnisotropyRotation??0;r.coatRoughnessAnisotropy=n,r.geometryCoatTangentAngle=s;const l=a.extensions??{};return l.EXT_materials_anisotropy_openpbr&&l.EXT_materials_anisotropy_openpbr.openPbrAnisotropyEnabled||r.configureGltfStyleAnisotropy(!0),a.clearcoatAnisotropyTexture&&(a.clearcoatAnisotropyTexture.nonColorData=!0,t.push(this._loader.loadTextureInfoAsync(`${e}/clearcoatAnisotropyTexture`,a.clearcoatAnisotropyTexture,(e=>{e.name=`${o.name} (Clearcoat Anisotropy)`,r.geometryCoatTangentTexture=e})))),Promise.all(t).then((()=>{}))}}o(t),r(t,!0,(e=>new n(e)));export{n as KHR_materials_clearcoat};
//# sourceMappingURL=KHR_materials_clearcoat-YMVaH7Ru.esm.min.js.map
