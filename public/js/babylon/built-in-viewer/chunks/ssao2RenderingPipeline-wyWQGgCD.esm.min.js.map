{"version":3,"file":"ssao2RenderingPipeline-wyWQGgCD.esm.min.js","sources":["../../../../../dev/core/dist/Rendering/ssao2Configuration.js","../../../../../dev/core/dist/PostProcesses/RenderPipeline/Pipelines/ssao2RenderingPipeline.js"],"sourcesContent":["import { Constants } from \"../Engines/constants\";\n/**\n * Contains all parameters needed for the prepass to perform\n * screen space subsurface scattering\n */\nexport class SSAO2Configuration {\n    constructor() {\n        /**\n         * Is subsurface enabled\n         */\n        this.enabled = false;\n        /**\n         * Name of the configuration\n         */\n        this.name = \"ssao2\";\n        /**\n         * Textures that should be present in the MRT for this effect to work\n         */\n        this.texturesRequired = [Constants.PREPASS_NORMAL_TEXTURE_TYPE, Constants.PREPASS_DEPTH_TEXTURE_TYPE];\n    }\n}\n//# sourceMappingURL=ssao2Configuration.js.map","import { __decorate } from \"tslib\";\n/* eslint-disable @typescript-eslint/naming-convention */\nimport { Logger } from \"../../../Misc/logger\";\nimport { serialize } from \"../../../Misc/decorators\";\nimport { SerializationHelper } from \"../../../Misc/decorators.serialization\";\nimport { Vector3, TmpVectors, Vector2 } from \"../../../Maths/math.vector\";\nimport { Camera } from \"../../../Cameras/camera\";\nimport { Texture } from \"../../../Materials/Textures/texture\";\nimport { PostProcess } from \"../../../PostProcesses/postProcess\";\nimport { PostProcessRenderPipeline } from \"../../../PostProcesses/RenderPipeline/postProcessRenderPipeline\";\nimport { PostProcessRenderEffect } from \"../../../PostProcesses/RenderPipeline/postProcessRenderEffect\";\nimport { PassPostProcess } from \"../../../PostProcesses/passPostProcess\";\nimport { RegisterClass } from \"../../../Misc/typeStore\";\nimport { EngineStore } from \"../../../Engines/engineStore\";\nimport { SSAO2Configuration } from \"../../../Rendering/ssao2Configuration\";\nimport { GeometryBufferRenderer } from \"../../../Rendering/geometryBufferRenderer\";\nimport { Constants } from \"../../../Engines/constants\";\nimport { RandomRange } from \"../../../Maths/math.scalar.functions\";\nimport { RawTexture } from \"../../../Materials/Textures/rawTexture\";\nimport \"../../../PostProcesses/RenderPipeline/postProcessRenderPipelineManagerSceneComponent\";\n/**\n * Render pipeline to produce ssao effect\n */\nexport class SSAO2RenderingPipeline extends PostProcessRenderPipeline {\n    /**\n     * Used in SSAO calculations to compensate for accuracy issues with depth values. Default 0.02.\n     *\n     * Normally you do not need to change this value, but you can experiment with it if you get a lot of in false self-occlusion on flat surfaces when using fewer than 16 samples. Useful range is normally [0..0.1] but higher values is allowed.\n     */\n    set epsilon(n) {\n        this._epsilon = n;\n        this._ssaoPostProcess.updateEffect(this._getDefinesForSSAO());\n    }\n    get epsilon() {\n        return this._epsilon;\n    }\n    /**\n     * Number of samples used for the SSAO calculations. Default value is 8.\n     */\n    set samples(n) {\n        this._samples = n;\n        this._ssaoPostProcess.updateEffect(this._getDefinesForSSAO());\n        this._sampleSphere = this._generateHemisphere();\n    }\n    get samples() {\n        return this._samples;\n    }\n    /**\n     * Number of samples to use for antialiasing.\n     */\n    set textureSamples(n) {\n        this._textureSamples = n;\n        if (this._prePassRenderer) {\n            this._prePassRenderer.samples = n;\n        }\n        else {\n            this._originalColorPostProcess.samples = n;\n        }\n    }\n    get textureSamples() {\n        return this._textureSamples;\n    }\n    get _geometryBufferRenderer() {\n        if (!this._forceGeometryBuffer) {\n            return null;\n        }\n        return this._forcedGeometryBuffer ?? this._scene.geometryBufferRenderer;\n    }\n    get _prePassRenderer() {\n        if (this._forceGeometryBuffer) {\n            return null;\n        }\n        return this._scene.prePassRenderer;\n    }\n    /**\n     * Skips the denoising (blur) stage of the SSAO calculations.\n     *\n     * Useful to temporarily set while experimenting with the other SSAO2 settings.\n     */\n    set bypassBlur(b) {\n        const defines = this._getDefinesForBlur(this.expensiveBlur, b);\n        const samplers = this._getSamplersForBlur(b);\n        this._blurHPostProcess.updateEffect(defines.h, null, samplers);\n        this._blurVPostProcess.updateEffect(defines.v, null, samplers);\n        this._bypassBlur = b;\n    }\n    get bypassBlur() {\n        return this._bypassBlur;\n    }\n    /**\n     * Enables the configurable bilateral denoising (blurring) filter. Default is true.\n     * Set to false to instead use a legacy bilateral filter that can't be configured.\n     *\n     * The denoising filter runs after the SSAO calculations and is a very important step. Both options results in a so called bilateral being used, but the \"expensive\" one can be\n     * configured in several ways to fit your scene.\n     */\n    set expensiveBlur(b) {\n        const defines = this._getDefinesForBlur(b, this._bypassBlur);\n        this._blurHPostProcess.updateEffect(defines.h);\n        this._blurVPostProcess.updateEffect(defines.v);\n        this._expensiveBlur = b;\n    }\n    get expensiveBlur() {\n        return this._expensiveBlur;\n    }\n    /**\n     *  Support test.\n     */\n    static get IsSupported() {\n        const engine = EngineStore.LastCreatedEngine;\n        if (!engine) {\n            return false;\n        }\n        return engine._features.supportSSAO2;\n    }\n    /**\n     * Gets active scene\n     */\n    get scene() {\n        return this._scene;\n    }\n    /**\n     * Creates the SSAO2 rendering pipeline.\n     * @param name The rendering pipeline name\n     * @param scene The scene linked to this pipeline\n     * @param ratio The size of the postprocesses. Can be a number shared between passes or an object for more precision: { ssaoRatio: 0.5, blurRatio: 1.0 }\n     * @param cameras The array of cameras that the rendering pipeline will be attached to\n     * @param forceGeometryBuffer Set to true if you want to use the legacy geometry buffer renderer. You can also pass an existing instance of GeometryBufferRenderer if you want to use your own geometry buffer renderer.\n     * @param textureType The texture type used by the different post processes created by SSAO (default: Constants.TEXTURETYPE_UNSIGNED_BYTE)\n     */\n    constructor(name, scene, ratio, cameras, forceGeometryBuffer = false, textureType = Constants.TEXTURETYPE_UNSIGNED_BYTE) {\n        super(scene.getEngine(), name);\n        // Members\n        /**\n         * @ignore\n         * The PassPostProcess id in the pipeline that contains the original scene color\n         */\n        this.SSAOOriginalSceneColorEffect = \"SSAOOriginalSceneColorEffect\";\n        /**\n         * @ignore\n         * The SSAO PostProcess id in the pipeline\n         */\n        this.SSAORenderEffect = \"SSAORenderEffect\";\n        /**\n         * @ignore\n         * The horizontal blur PostProcess id in the pipeline\n         */\n        this.SSAOBlurHRenderEffect = \"SSAOBlurHRenderEffect\";\n        /**\n         * @ignore\n         * The vertical blur PostProcess id in the pipeline\n         */\n        this.SSAOBlurVRenderEffect = \"SSAOBlurVRenderEffect\";\n        /**\n         * @ignore\n         * The PostProcess id in the pipeline that combines the SSAO-Blur output with the original scene color (SSAOOriginalSceneColorEffect)\n         */\n        this.SSAOCombineRenderEffect = \"SSAOCombineRenderEffect\";\n        /**\n         * The output strength of the SSAO post-process. Default value is 1.0.\n         */\n        this.totalStrength = 1.0;\n        /**\n         * Maximum depth value to still render AO. A smooth falloff makes the dimming more natural, so there will be no abrupt shading change.\n         */\n        this.maxZ = 100.0;\n        /**\n         * In order to save performances, SSAO radius is clamped on close geometry. This ratio changes by how much.\n         */\n        this.minZAspect = 0.2;\n        this._epsilon = 0.02;\n        this._samples = 8;\n        this._textureSamples = 1;\n        this._forcedGeometryBuffer = null;\n        /**\n         * Force rendering the geometry through geometry buffer.\n         */\n        this._forceGeometryBuffer = false;\n        /**\n         * The radius around the analyzed pixel used by the SSAO post-process. Default value is 2.0\n         */\n        this.radius = 2.0;\n        /**\n         * The base color of the SSAO post-process\n         * The final result is \"base + ssao\" between [0, 1]\n         */\n        this.base = 0;\n        this._bypassBlur = false;\n        this._expensiveBlur = true;\n        /**\n         * The number of samples the bilateral filter uses in both dimensions when denoising the SSAO calculations. Default value is 16.\n         *\n         * A higher value should result in smoother shadows but will use more processing time in the shaders.\n         *\n         * A high value can cause the shadows to get to blurry or create visible artifacts (bands) near sharp details in the geometry. The artifacts can sometimes be mitigated by increasing the bilateralSoften setting.\n         */\n        this.bilateralSamples = 16;\n        /**\n         * Controls the shape of the denoising kernel used by the bilateral filter. Default value is 0.\n         *\n         * By default the bilateral filter acts like a box-filter, treating all samples on the same depth with equal weights. This is effective to maximize the denoising effect given a limited set of samples. However, it also often results in visible ghosting around sharp shadow regions and can spread out lines over large areas so they are no longer visible.\n         *\n         * Increasing this setting will make the filter pay less attention to samples further away from the center sample, reducing many artifacts but at the same time increasing noise.\n         *\n         * Useful value range is [0..1].\n         */\n        this.bilateralSoften = 0;\n        /**\n         * How forgiving the bilateral denoiser should be when rejecting samples. Default value is 0.\n         *\n         * A higher value results in the bilateral filter being more forgiving and thus doing a better job at denoising slanted and curved surfaces, but can lead to shadows spreading out around corners or between objects that are close to each other depth wise.\n         *\n         * Useful value range is normally [0..1], but higher values are allowed.\n         */\n        this.bilateralTolerance = 0;\n        /**\n         * Indicates that the combine stage should use the current camera viewport to render the SSAO result on only a portion of the output texture (default: true).\n         */\n        this.useViewportInCombineStage = true;\n        this._bits = new Uint32Array(1);\n        this._scene = scene;\n        this._ratio = ratio;\n        this._textureType = textureType;\n        if (forceGeometryBuffer instanceof GeometryBufferRenderer) {\n            this._forceGeometryBuffer = true;\n            this._forcedGeometryBuffer = forceGeometryBuffer;\n        }\n        else {\n            this._forceGeometryBuffer = forceGeometryBuffer;\n        }\n        if (!this.isSupported) {\n            Logger.Error(\"The current engine does not support SSAO 2.\");\n            return;\n        }\n        const ssaoRatio = this._ratio.ssaoRatio || ratio;\n        const blurRatio = this._ratio.blurRatio || ratio;\n        // Set up assets\n        if (this._forceGeometryBuffer) {\n            if (!this._forcedGeometryBuffer) {\n                scene.enableGeometryBufferRenderer();\n            }\n            if (scene.geometryBufferRenderer?.generateNormalsInWorldSpace) {\n                Logger.Error(\"SSAO2RenderingPipeline does not support generateNormalsInWorldSpace=true for the geometry buffer renderer!\");\n            }\n        }\n        else {\n            scene.enablePrePassRenderer();\n            if (scene.prePassRenderer?.generateNormalsInWorldSpace) {\n                Logger.Error(\"SSAO2RenderingPipeline does not support generateNormalsInWorldSpace=true for the prepass renderer!\");\n            }\n        }\n        this._createRandomTexture();\n        this._originalColorPostProcess = new PassPostProcess(\"SSAOOriginalSceneColor\", 1.0, null, Texture.BILINEAR_SAMPLINGMODE, scene.getEngine(), undefined, this._textureType);\n        this._originalColorPostProcess.samples = this.textureSamples;\n        this._createSSAOPostProcess(1.0, textureType);\n        this._createBlurPostProcess(ssaoRatio, blurRatio, this._textureType);\n        this._createSSAOCombinePostProcess(blurRatio, this._textureType);\n        // Set up pipeline\n        this.addEffect(new PostProcessRenderEffect(scene.getEngine(), this.SSAOOriginalSceneColorEffect, () => {\n            return this._originalColorPostProcess;\n        }, true));\n        this.addEffect(new PostProcessRenderEffect(scene.getEngine(), this.SSAORenderEffect, () => {\n            return this._ssaoPostProcess;\n        }, true));\n        this.addEffect(new PostProcessRenderEffect(scene.getEngine(), this.SSAOBlurHRenderEffect, () => {\n            return this._blurHPostProcess;\n        }, true));\n        this.addEffect(new PostProcessRenderEffect(scene.getEngine(), this.SSAOBlurVRenderEffect, () => {\n            return this._blurVPostProcess;\n        }, true));\n        this.addEffect(new PostProcessRenderEffect(scene.getEngine(), this.SSAOCombineRenderEffect, () => {\n            return this._ssaoCombinePostProcess;\n        }, true));\n        // Finish\n        scene.postProcessRenderPipelineManager.addPipeline(this);\n        if (cameras) {\n            scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(name, cameras);\n        }\n    }\n    // Public Methods\n    /**\n     * Get the class name\n     * @returns \"SSAO2RenderingPipeline\"\n     */\n    getClassName() {\n        return \"SSAO2RenderingPipeline\";\n    }\n    /**\n     * Removes the internal pipeline assets and detaches the pipeline from the scene cameras\n     * @param disableGeometryBufferRenderer Set to true if you want to disable the Geometry Buffer renderer\n     */\n    dispose(disableGeometryBufferRenderer = false) {\n        for (let i = 0; i < this._scene.cameras.length; i++) {\n            const camera = this._scene.cameras[i];\n            this._originalColorPostProcess.dispose(camera);\n            this._ssaoPostProcess.dispose(camera);\n            this._blurHPostProcess.dispose(camera);\n            this._blurVPostProcess.dispose(camera);\n            this._ssaoCombinePostProcess.dispose(camera);\n        }\n        this._randomTexture.dispose();\n        if (disableGeometryBufferRenderer && !this._forcedGeometryBuffer) {\n            this._scene.disableGeometryBufferRenderer();\n        }\n        this._scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this._name, this._scene.cameras);\n        this._scene.postProcessRenderPipelineManager.removePipeline(this._name);\n        super.dispose();\n    }\n    // Private Methods\n    /** @internal */\n    _rebuild() {\n        super._rebuild();\n    }\n    _getSamplersForBlur(disabled) {\n        return disabled ? [\"textureSampler\"] : [\"textureSampler\", \"depthSampler\"];\n    }\n    _getDefinesForBlur(bilateral, disabled) {\n        let define = \"#define BLUR\\n\";\n        if (disabled) {\n            define += \"#define BLUR_BYPASS\\n\";\n        }\n        if (!bilateral) {\n            define += \"#define BLUR_LEGACY\\n\";\n        }\n        return { h: define + \"#define BLUR_H\\n\", v: define };\n    }\n    _createBlurPostProcess(ssaoRatio, blurRatio, textureType) {\n        const defines = this._getDefinesForBlur(this.expensiveBlur, this.bypassBlur);\n        const samplers = this._getSamplersForBlur(this.bypassBlur);\n        this._blurHPostProcess = this._createBlurFilter(\"BlurH\", samplers, ssaoRatio, defines.h, textureType, true);\n        this._blurVPostProcess = this._createBlurFilter(\"BlurV\", samplers, blurRatio, defines.v, textureType, false);\n    }\n    _createBlurFilter(name, samplers, ratio, defines, textureType, horizontal) {\n        const blurFilter = new PostProcess(name, \"ssao2\", [\"outSize\", \"samples\", \"soften\", \"tolerance\"], samplers, ratio, null, Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), false, defines, textureType, undefined, undefined, undefined, undefined, this._scene.getEngine().isWebGPU ? 1 /* ShaderLanguage.WGSL */ : 0 /* ShaderLanguage.GLSL */, (useWebGPU, list) => {\n            if (useWebGPU) {\n                list.push(import(\"../../../ShadersWGSL/ssao2.fragment\"));\n            }\n            else {\n                list.push(import(\"../../../Shaders/ssao2.fragment\"));\n            }\n        });\n        blurFilter.onApply = (effect) => {\n            if (!this._scene.activeCamera) {\n                return;\n            }\n            const ratio = this._ratio.blurRatio || this._ratio;\n            const ssaoCombineSize = horizontal ? this._originalColorPostProcess.width * ratio : this._originalColorPostProcess.height * ratio;\n            const originalColorSize = horizontal ? this._originalColorPostProcess.width : this._originalColorPostProcess.height;\n            effect.setFloat(\"outSize\", ssaoCombineSize > 0 ? ssaoCombineSize : originalColorSize);\n            effect.setInt(\"samples\", this.bilateralSamples);\n            effect.setFloat(\"soften\", this.bilateralSoften);\n            effect.setFloat(\"tolerance\", this.bilateralTolerance);\n            if (this._geometryBufferRenderer) {\n                effect.setTexture(\"depthSampler\", this._geometryBufferRenderer.getGBuffer().textures[0]);\n            }\n            else if (this._prePassRenderer) {\n                effect.setTexture(\"depthSampler\", this._prePassRenderer.getRenderTarget().textures[this._prePassRenderer.getIndex(Constants.PREPASS_DEPTH_TEXTURE_TYPE)]);\n            }\n        };\n        blurFilter.samples = this.textureSamples;\n        blurFilter.autoClear = false;\n        return blurFilter;\n    }\n    //Van der Corput radical inverse\n    _radicalInverse_VdC(i) {\n        this._bits[0] = i;\n        this._bits[0] = ((this._bits[0] << 16) | (this._bits[0] >> 16)) >>> 0;\n        this._bits[0] = ((this._bits[0] & 0x55555555) << 1) | (((this._bits[0] & 0xaaaaaaaa) >>> 1) >>> 0);\n        this._bits[0] = ((this._bits[0] & 0x33333333) << 2) | (((this._bits[0] & 0xcccccccc) >>> 2) >>> 0);\n        this._bits[0] = ((this._bits[0] & 0x0f0f0f0f) << 4) | (((this._bits[0] & 0xf0f0f0f0) >>> 4) >>> 0);\n        this._bits[0] = ((this._bits[0] & 0x00ff00ff) << 8) | (((this._bits[0] & 0xff00ff00) >>> 8) >>> 0);\n        return this._bits[0] * 2.3283064365386963e-10; // / 0x100000000 or / 4294967296\n    }\n    _hammersley(i, n) {\n        return [i / n, this._radicalInverse_VdC(i)];\n    }\n    _hemisphereSample_uniform(u, v) {\n        const phi = v * 2.0 * Math.PI;\n        // rejecting samples that are close to tangent plane to avoid z-fighting artifacts\n        const cosTheta = 1.0 - u * 0.85;\n        const sinTheta = Math.sqrt(1.0 - cosTheta * cosTheta);\n        return new Vector3(Math.cos(phi) * sinTheta, Math.sin(phi) * sinTheta, cosTheta);\n    }\n    _generateHemisphere() {\n        const numSamples = this.samples;\n        const result = [];\n        let vector;\n        let i = 0;\n        while (i < numSamples) {\n            if (numSamples < 16) {\n                vector = this._hemisphereSample_uniform(Math.random(), Math.random());\n            }\n            else {\n                const rand = this._hammersley(i, numSamples);\n                vector = this._hemisphereSample_uniform(rand[0], rand[1]);\n            }\n            result.push(vector.x, vector.y, vector.z);\n            i++;\n        }\n        return result;\n    }\n    _getDefinesForSSAO() {\n        let defines = `#define SSAO\\n#define SAMPLES ${this.samples}\\n#define EPSILON ${this.epsilon.toFixed(4)}`;\n        if (this._scene.activeCamera?.mode === Camera.ORTHOGRAPHIC_CAMERA) {\n            defines += `\\n#define ORTHOGRAPHIC_CAMERA`;\n        }\n        return defines;\n    }\n    _createSSAOPostProcess(ratio, textureType) {\n        this._sampleSphere = this._generateHemisphere();\n        const defines = this._getDefinesForSSAO();\n        const samplers = [\"randomSampler\", \"depthSampler\", \"normalSampler\"];\n        this._ssaoPostProcess = new PostProcess(\"ssao2\", \"ssao2\", [\n            \"sampleSphere\",\n            \"samplesFactor\",\n            \"randTextureTiles\",\n            \"totalStrength\",\n            \"radius\",\n            \"base\",\n            \"range\",\n            \"projection\",\n            \"near\",\n            \"texelSize\",\n            \"xViewport\",\n            \"yViewport\",\n            \"viewport\",\n            \"maxZ\",\n            \"minZAspect\",\n            \"depthProjection\",\n        ], samplers, ratio, null, Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), false, defines, textureType, undefined, undefined, undefined, undefined, this._scene.getEngine().isWebGPU ? 1 /* ShaderLanguage.WGSL */ : 0 /* ShaderLanguage.GLSL */, (useWebGPU, list) => {\n            if (useWebGPU) {\n                list.push(import(\"../../../ShadersWGSL/ssao2.fragment\"));\n            }\n            else {\n                list.push(import(\"../../../Shaders/ssao2.fragment\"));\n            }\n        });\n        this._ssaoPostProcess.autoClear = false;\n        this._ssaoPostProcess.onApply = (effect) => {\n            if (!this._scene.activeCamera) {\n                return;\n            }\n            effect.setArray3(\"sampleSphere\", this._sampleSphere);\n            effect.setFloat(\"randTextureTiles\", 32.0);\n            effect.setFloat(\"samplesFactor\", 1 / this.samples);\n            effect.setFloat(\"totalStrength\", this.totalStrength);\n            effect.setFloat2(\"texelSize\", 1 / this._ssaoPostProcess.width, 1 / this._ssaoPostProcess.height);\n            effect.setFloat(\"radius\", this.radius);\n            effect.setFloat(\"maxZ\", this.maxZ);\n            effect.setFloat(\"minZAspect\", this.minZAspect);\n            effect.setFloat(\"base\", this.base);\n            effect.setFloat(\"near\", this._scene.activeCamera.minZ);\n            if (this._scene.activeCamera.mode === Camera.PERSPECTIVE_CAMERA) {\n                effect.setMatrix3x3(\"depthProjection\", SSAO2RenderingPipeline.PERSPECTIVE_DEPTH_PROJECTION);\n                effect.setFloat(\"xViewport\", Math.tan(this._scene.activeCamera.fov / 2) * this._scene.getEngine().getAspectRatio(this._scene.activeCamera, true));\n                effect.setFloat(\"yViewport\", Math.tan(this._scene.activeCamera.fov / 2));\n            }\n            else {\n                const halfWidth = this._scene.getEngine().getRenderWidth() / 2.0;\n                const halfHeight = this._scene.getEngine().getRenderHeight() / 2.0;\n                const orthoLeft = this._scene.activeCamera.orthoLeft ?? -halfWidth;\n                const orthoRight = this._scene.activeCamera.orthoRight ?? halfWidth;\n                const orthoBottom = this._scene.activeCamera.orthoBottom ?? -halfHeight;\n                const orthoTop = this._scene.activeCamera.orthoTop ?? halfHeight;\n                effect.setMatrix3x3(\"depthProjection\", SSAO2RenderingPipeline.ORTHO_DEPTH_PROJECTION);\n                effect.setFloat4(\"viewport\", orthoLeft, orthoRight, orthoBottom, orthoTop);\n            }\n            effect.setMatrix(\"projection\", this._scene.getProjectionMatrix());\n            if (this._geometryBufferRenderer) {\n                effect.setTexture(\"depthSampler\", this._geometryBufferRenderer.getGBuffer().textures[0]);\n                effect.setTexture(\"normalSampler\", this._geometryBufferRenderer.getGBuffer().textures[1]);\n            }\n            else if (this._prePassRenderer) {\n                effect.setTexture(\"depthSampler\", this._prePassRenderer.getRenderTarget().textures[this._prePassRenderer.getIndex(Constants.PREPASS_DEPTH_TEXTURE_TYPE)]);\n                effect.setTexture(\"normalSampler\", this._prePassRenderer.getRenderTarget().textures[this._prePassRenderer.getIndex(Constants.PREPASS_NORMAL_TEXTURE_TYPE)]);\n            }\n            effect.setTexture(\"randomSampler\", this._randomTexture);\n        };\n        this._ssaoPostProcess.samples = this.textureSamples;\n        if (!this._forceGeometryBuffer) {\n            this._ssaoPostProcess._prePassEffectConfiguration = new SSAO2Configuration();\n        }\n    }\n    _createSSAOCombinePostProcess(ratio, textureType) {\n        this._ssaoCombinePostProcess = new PostProcess(\"ssaoCombine\", \"ssaoCombine\", [], [\"originalColor\", \"viewport\"], ratio, null, Texture.BILINEAR_SAMPLINGMODE, this._scene.getEngine(), false, undefined, textureType, undefined, undefined, undefined, undefined, this._scene.getEngine().isWebGPU ? 1 /* ShaderLanguage.WGSL */ : 0 /* ShaderLanguage.GLSL */, (useWebGPU, list) => {\n            if (useWebGPU) {\n                list.push(import(\"../../../ShadersWGSL/ssaoCombine.fragment\"));\n            }\n            else {\n                list.push(import(\"../../../Shaders/ssaoCombine.fragment\"));\n            }\n        });\n        this._ssaoCombinePostProcess.onApply = (effect) => {\n            const viewport = this._scene.activeCamera.viewport;\n            if (this.useViewportInCombineStage) {\n                effect.setVector4(\"viewport\", TmpVectors.Vector4[0].copyFromFloats(viewport.x, viewport.y, viewport.width, viewport.height));\n            }\n            else {\n                effect.setVector4(\"viewport\", TmpVectors.Vector4[0].copyFromFloats(0, 0, 1, 1));\n            }\n            effect.setTextureFromPostProcessOutput(\"originalColor\", this._originalColorPostProcess);\n        };\n        this._ssaoCombinePostProcess.autoClear = false;\n        this._ssaoCombinePostProcess.samples = this.textureSamples;\n    }\n    _createRandomTexture() {\n        const size = 128;\n        const data = new Uint8Array(size * size * 4);\n        const randVector = Vector2.Zero();\n        for (let index = 0; index < data.length;) {\n            randVector.set(RandomRange(0, 1), RandomRange(0, 1)).normalize().scaleInPlace(255);\n            data[index++] = Math.floor(randVector.x);\n            data[index++] = Math.floor(randVector.y);\n            data[index++] = 0;\n            data[index++] = 255;\n        }\n        const texture = RawTexture.CreateRGBATexture(data, size, size, this._scene, false, false, Constants.TEXTURE_BILINEAR_SAMPLINGMODE);\n        texture.name = \"SSAORandomTexture\";\n        texture.wrapU = Texture.WRAP_ADDRESSMODE;\n        texture.wrapV = Texture.WRAP_ADDRESSMODE;\n        this._randomTexture = texture;\n    }\n    /**\n     * Serialize the rendering pipeline (Used when exporting)\n     * @returns the serialized object\n     */\n    serialize() {\n        const serializationObject = SerializationHelper.Serialize(this);\n        serializationObject.customType = \"SSAO2RenderingPipeline\";\n        return serializationObject;\n    }\n    /**\n     * Parse the serialized pipeline\n     * @param source Source pipeline.\n     * @param scene The scene to load the pipeline to.\n     * @param rootUrl The URL of the serialized pipeline.\n     * @returns An instantiated pipeline from the serialized object.\n     */\n    static Parse(source, scene, rootUrl) {\n        return SerializationHelper.Parse(() => new SSAO2RenderingPipeline(source._name, scene, source._ratio, undefined, source._forceGeometryBuffer, source._textureType), source, scene, rootUrl);\n    }\n}\nSSAO2RenderingPipeline.ORTHO_DEPTH_PROJECTION = [1, 0, 0, 0, 1, 0, 0, 0, 1];\nSSAO2RenderingPipeline.PERSPECTIVE_DEPTH_PROJECTION = [0, 0, 0, 0, 0, 0, 1, 1, 1];\n__decorate([\n    serialize()\n], SSAO2RenderingPipeline.prototype, \"totalStrength\", void 0);\n__decorate([\n    serialize()\n], SSAO2RenderingPipeline.prototype, \"maxZ\", void 0);\n__decorate([\n    serialize()\n], SSAO2RenderingPipeline.prototype, \"minZAspect\", void 0);\n__decorate([\n    serialize(\"epsilon\")\n], SSAO2RenderingPipeline.prototype, \"_epsilon\", void 0);\n__decorate([\n    serialize(\"samples\")\n], SSAO2RenderingPipeline.prototype, \"_samples\", void 0);\n__decorate([\n    serialize(\"textureSamples\")\n], SSAO2RenderingPipeline.prototype, \"_textureSamples\", void 0);\n__decorate([\n    serialize()\n], SSAO2RenderingPipeline.prototype, \"_forceGeometryBuffer\", void 0);\n__decorate([\n    serialize()\n], SSAO2RenderingPipeline.prototype, \"_ratio\", void 0);\n__decorate([\n    serialize()\n], SSAO2RenderingPipeline.prototype, \"_textureType\", void 0);\n__decorate([\n    serialize()\n], SSAO2RenderingPipeline.prototype, \"radius\", void 0);\n__decorate([\n    serialize()\n], SSAO2RenderingPipeline.prototype, \"base\", void 0);\n__decorate([\n    serialize(\"bypassBlur\")\n], SSAO2RenderingPipeline.prototype, \"_bypassBlur\", void 0);\n__decorate([\n    serialize(\"expensiveBlur\")\n], SSAO2RenderingPipeline.prototype, \"_expensiveBlur\", void 0);\n__decorate([\n    serialize()\n], SSAO2RenderingPipeline.prototype, \"bilateralSamples\", void 0);\n__decorate([\n    serialize()\n], SSAO2RenderingPipeline.prototype, \"bilateralSoften\", void 0);\n__decorate([\n    serialize()\n], SSAO2RenderingPipeline.prototype, \"bilateralTolerance\", void 0);\nRegisterClass(\"BABYLON.SSAO2RenderingPipeline\", SSAO2RenderingPipeline);\n//# sourceMappingURL=ssao2RenderingPipeline.js.map"],"names":["SSAO2Configuration","constructor","this","enabled","name","texturesRequired","Constants","PREPASS_NORMAL_TEXTURE_TYPE","PREPASS_DEPTH_TEXTURE_TYPE","SSAO2RenderingPipeline","PostProcessRenderPipeline","epsilon","n","_epsilon","_ssaoPostProcess","updateEffect","_getDefinesForSSAO","samples","_samples","_sampleSphere","_generateHemisphere","textureSamples","_textureSamples","_prePassRenderer","_originalColorPostProcess","_geometryBufferRenderer","_forceGeometryBuffer","_forcedGeometryBuffer","_scene","geometryBufferRenderer","prePassRenderer","bypassBlur","b","defines","_getDefinesForBlur","expensiveBlur","samplers","_getSamplersForBlur","_blurHPostProcess","h","_blurVPostProcess","v","_bypassBlur","_expensiveBlur","IsSupported","engine","EngineStore","LastCreatedEngine","_features","supportSSAO2","scene","ratio","cameras","forceGeometryBuffer","textureType","TEXTURETYPE_UNSIGNED_BYTE","super","getEngine","SSAOOriginalSceneColorEffect","SSAORenderEffect","SSAOBlurHRenderEffect","SSAOBlurVRenderEffect","SSAOCombineRenderEffect","totalStrength","maxZ","minZAspect","radius","base","bilateralSamples","bilateralSoften","bilateralTolerance","useViewportInCombineStage","_bits","Uint32Array","_ratio","_textureType","GeometryBufferRenderer","isSupported","Logger","Error","ssaoRatio","blurRatio","enableGeometryBufferRenderer","generateNormalsInWorldSpace","enablePrePassRenderer","_createRandomTexture","PassPostProcess","Texture","BILINEAR_SAMPLINGMODE","undefined","_createSSAOPostProcess","_createBlurPostProcess","_createSSAOCombinePostProcess","addEffect","PostProcessRenderEffect","_ssaoCombinePostProcess","postProcessRenderPipelineManager","addPipeline","attachCamerasToRenderPipeline","getClassName","dispose","disableGeometryBufferRenderer","i","length","camera","_randomTexture","detachCamerasFromRenderPipeline","_name","removePipeline","_rebuild","disabled","bilateral","define","_createBlurFilter","horizontal","blurFilter","PostProcess","isWebGPU","useWebGPU","list","push","import","onApply","effect","activeCamera","ssaoCombineSize","width","height","originalColorSize","setFloat","setInt","setTexture","getGBuffer","textures","getRenderTarget","getIndex","autoClear","_radicalInverse_VdC","_hammersley","_hemisphereSample_uniform","u","phi","Math","PI","cosTheta","sinTheta","sqrt","Vector3","cos","sin","numSamples","result","vector","random","rand","x","y","z","toFixed","mode","Camera","ORTHOGRAPHIC_CAMERA","setArray3","setFloat2","minZ","PERSPECTIVE_CAMERA","setMatrix3x3","PERSPECTIVE_DEPTH_PROJECTION","tan","fov","getAspectRatio","halfWidth","getRenderWidth","halfHeight","getRenderHeight","orthoLeft","orthoRight","orthoBottom","orthoTop","ORTHO_DEPTH_PROJECTION","setFloat4","setMatrix","getProjectionMatrix","_prePassEffectConfiguration","viewport","setVector4","TmpVectors","Vector4","copyFromFloats","setTextureFromPostProcessOutput","size","data","Uint8Array","randVector","Vector2","Zero","index","set","RandomRange","normalize","scaleInPlace","floor","texture","RawTexture","CreateRGBATexture","TEXTURE_BILINEAR_SAMPLINGMODE","wrapU","WRAP_ADDRESSMODE","wrapV","serialize","serializationObject","SerializationHelper","Serialize","customType","Parse","source","rootUrl","__decorate","prototype","RegisterClass"],"mappings":"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"}