{"version":3,"file":"webAudioSoundSource-Ddx8qbPX.esm.min.js","sources":["../../../../../dev/core/dist/AudioV2/webAudio/webAudioSoundSource.js"],"sourcesContent":["import { AbstractSoundSource } from \"../abstractAudio/abstractSoundSource\";\nimport { _HasSpatialAudioOptions } from \"../abstractAudio/subProperties/abstractSpatialAudio\";\nimport { _StereoAudio } from \"../abstractAudio/subProperties/stereoAudio\";\nimport { _WebAudioBusAndSoundSubGraph } from \"./subNodes/webAudioBusAndSoundSubGraph\";\nimport { _SpatialWebAudio } from \"./subProperties/spatialWebAudio\";\n/** @internal */\nexport class _WebAudioSoundSource extends AbstractSoundSource {\n    /** @internal */\n    constructor(name, webAudioNode, engine, options) {\n        super(name, engine);\n        this._spatial = null;\n        this._spatialAutoUpdate = true;\n        this._spatialMinUpdateTime = 0;\n        this._stereo = null;\n        if (typeof options.spatialAutoUpdate === \"boolean\") {\n            this._spatialAutoUpdate = options.spatialAutoUpdate;\n        }\n        if (typeof options.spatialMinUpdateTime === \"number\") {\n            this._spatialMinUpdateTime = options.spatialMinUpdateTime;\n        }\n        this._audioContext = this.engine._audioContext;\n        this._webAudioNode = webAudioNode;\n        this._subGraph = new _WebAudioSoundSource._SubGraph(this);\n    }\n    /** @internal */\n    async _initAsync(options) {\n        if (options.outBus) {\n            this.outBus = options.outBus;\n        }\n        else if (options.outBusAutoDefault !== false) {\n            await this.engine.isReadyPromise;\n            this.outBus = this.engine.defaultMainBus;\n        }\n        await this._subGraph.initAsync(options);\n        if (_HasSpatialAudioOptions(options)) {\n            this._initSpatialProperty();\n        }\n        this.engine._addNode(this);\n    }\n    /** @internal */\n    get _inNode() {\n        return this._webAudioNode;\n    }\n    /** @internal */\n    get _outNode() {\n        return this._subGraph._outNode;\n    }\n    /** @internal */\n    get spatial() {\n        if (this._spatial) {\n            return this._spatial;\n        }\n        return this._initSpatialProperty();\n    }\n    /** @internal */\n    get stereo() {\n        return this._stereo ?? (this._stereo = new _StereoAudio(this._subGraph));\n    }\n    /** @internal */\n    dispose() {\n        super.dispose();\n        this._spatial?.dispose();\n        this._spatial = null;\n        this._stereo = null;\n        this._subGraph.dispose();\n        this.engine._removeNode(this);\n    }\n    /** @internal */\n    getClassName() {\n        return \"_WebAudioSoundSource\";\n    }\n    _connect(node) {\n        const connected = super._connect(node);\n        if (!connected) {\n            return false;\n        }\n        // If the wrapped node is not available now, it will be connected later by the subgraph.\n        if (node._inNode) {\n            this._outNode?.connect(node._inNode);\n        }\n        return true;\n    }\n    _disconnect(node) {\n        const disconnected = super._disconnect(node);\n        if (!disconnected) {\n            return false;\n        }\n        if (node._inNode) {\n            this._outNode?.disconnect(node._inNode);\n        }\n        return true;\n    }\n    _initSpatialProperty() {\n        if (!this._spatial) {\n            this._spatial = new _SpatialWebAudio(this._subGraph, this._spatialAutoUpdate, this._spatialMinUpdateTime);\n        }\n        return this._spatial;\n    }\n}\n_WebAudioSoundSource._SubGraph = class extends _WebAudioBusAndSoundSubGraph {\n    get _downstreamNodes() {\n        return this._owner._downstreamNodes ?? null;\n    }\n    get _upstreamNodes() {\n        return this._owner._upstreamNodes ?? null;\n    }\n    _onSubNodesChanged() {\n        super._onSubNodesChanged();\n        this._owner._inNode.disconnect();\n        if (this._owner._subGraph._inNode) {\n            this._owner._inNode.connect(this._owner._subGraph._inNode);\n        }\n    }\n};\n//# sourceMappingURL=webAudioSoundSource.js.map"],"names":["_WebAudioSoundSource","AbstractSoundSource","constructor","name","webAudioNode","engine","options","super","this","_spatial","_spatialAutoUpdate","_spatialMinUpdateTime","_stereo","spatialAutoUpdate","spatialMinUpdateTime","_audioContext","_webAudioNode","_subGraph","_SubGraph","_initAsync","outBus","outBusAutoDefault","isReadyPromise","defaultMainBus","initAsync","_HasSpatialAudioOptions","_initSpatialProperty","_addNode","_inNode","_outNode","spatial","stereo","_StereoAudio","dispose","_removeNode","getClassName","_connect","node","connect","_disconnect","disconnect","_SpatialWebAudio","_WebAudioBusAndSoundSubGraph","_downstreamNodes","_owner","_upstreamNodes","_onSubNodesChanged"],"mappings":"8QAMO,MAAMA,UAA6BC,EAEtC,WAAAC,CAAYC,EAAMC,EAAcC,EAAQC,GACpCC,MAAMJ,EAAME,GACZG,KAAKC,SAAW,KAChBD,KAAKE,oBAAqB,EAC1BF,KAAKG,sBAAwB,EAC7BH,KAAKI,QAAU,KAC0B,kBAA9BN,EAAQO,oBACfL,KAAKE,mBAAqBJ,EAAQO,mBAEM,iBAAjCP,EAAQQ,uBACfN,KAAKG,sBAAwBL,EAAQQ,sBAEzCN,KAAKO,cAAgBP,KAAKH,OAAOU,cACjCP,KAAKQ,cAAgBZ,EACrBI,KAAKS,UAAY,IAAIjB,EAAqBkB,UAAUV,KAC5D,CAEI,gBAAMW,CAAWb,GACTA,EAAQc,OACRZ,KAAKY,OAASd,EAAQc,QAEa,IAA9Bd,EAAQe,0BACPb,KAAKH,OAAOiB,eAClBd,KAAKY,OAASZ,KAAKH,OAAOkB,sBAExBf,KAAKS,UAAUO,UAAUlB,GAC3BmB,EAAwBnB,IACxBE,KAAKkB,uBAETlB,KAAKH,OAAOsB,SAASnB,KAC7B,CAEI,WAAIoB,GACA,OAAOpB,KAAKQ,aACpB,CAEI,YAAIa,GACA,OAAOrB,KAAKS,UAAUY,QAC9B,CAEI,WAAIC,GACA,OAAItB,KAAKC,SACED,KAAKC,SAETD,KAAKkB,sBACpB,CAEI,UAAIK,GACA,OAAOvB,KAAKI,UAAYJ,KAAKI,QAAU,IAAIoB,EAAaxB,KAAKS,WACrE,CAEI,OAAAgB,GACI1B,MAAM0B,UACNzB,KAAKC,UAAUwB,UACfzB,KAAKC,SAAW,KAChBD,KAAKI,QAAU,KACfJ,KAAKS,UAAUgB,UACfzB,KAAKH,OAAO6B,YAAY1B,KAChC,CAEI,YAAA2B,GACI,MAAO,sBACf,CACI,QAAAC,CAASC,GAEL,QADkB9B,MAAM6B,SAASC,KAK7BA,EAAKT,SACLpB,KAAKqB,UAAUS,QAAQD,EAAKT,UAEzB,EACf,CACI,WAAAW,CAAYF,GAER,QADqB9B,MAAMgC,YAAYF,KAInCA,EAAKT,SACLpB,KAAKqB,UAAUW,WAAWH,EAAKT,UAE5B,EACf,CACI,oBAAAF,GAII,OAHKlB,KAAKC,WACND,KAAKC,SAAW,IAAIgC,EAAiBjC,KAAKS,UAAWT,KAAKE,mBAAoBF,KAAKG,wBAEhFH,KAAKC,QACpB,EAEAT,EAAqBkB,UAAY,cAAcwB,EAC3C,oBAAIC,GACA,OAAOnC,KAAKoC,OAAOD,kBAAoB,IAC/C,CACI,kBAAIE,GACA,OAAOrC,KAAKoC,OAAOC,gBAAkB,IAC7C,CACI,kBAAAC,GACIvC,MAAMuC,qBACNtC,KAAKoC,OAAOhB,QAAQY,aAChBhC,KAAKoC,OAAO3B,UAAUW,SACtBpB,KAAKoC,OAAOhB,QAAQU,QAAQ9B,KAAKoC,OAAO3B,UAAUW,QAE9D"}